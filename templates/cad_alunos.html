<!DOCTYPE html>
<html lang = "pt-br">

<head>
    <meta charset = "UTF-8">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <title>Cadastro de Alunos</title>
    <link rel = "stylesheet" href = "../static/css/style.css">
</head>

<body>
    <header>
        <nav>
            <button class="menu-btn">☰</button>
            <ul class="menu">
                <li><a href="/"> Início </a></li>
                <li><a href="/sobre"> Sobre </a></li>
                <li><a href="/blog"> Blog </a></li>
                <li><a href="/cadastrar"> Cadastros </a></li>
                <li><a href="/divulgacao_escolas"> Escolas </a></li>
                <li><a href="/vagas"> Vagas </a></li>
                <li><a href="/cursos"> Cursos </a></li>
            </ul>
        </nav>
    </header>
    <h1>Cadastro de Alunos</h1>

    <form action    = "http://127.0.0.1:5000/cadastrar_alunos" method = "POST" class="cadform">

        <!-- campo para nome do aluno -->
        <label for  = "nome">Nome Completo:</label>
        <input type = "text" name="nome" id="nome" required>
        
        <!-- campo para e-mail do aluno -->
        <label for  = "email">Email (@escola):</label>
        <input type = "email" name="email" required>

        <!-- campo para telefone do aluno -->
        <label for  = "telefone">Telefone (+55):</label>
        <input type = "text" name="telefone" id="telefone" required>

        <!-- campo para cgm do aluno -->
        <label for  = "cgm">CGM:</label>
        <input type = "text" name="cgm" id="cgm" required>

        <!-- campo para idade do aluno -->
        <label for  = "idade">Data de Nascimento:</label>
        <input type = "date" name="idade" id="idade" required>

        <!-- Endereço -->
        <div>
            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" placeholder="Ex: 01001000" maxlength="8" required>
        </div>
            
        <div>
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" required>
        </div>
            
        <div>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" required>
        </div>
            
        <div>
            <label for="estado">Estado (UF):</label>
            <input type="text" id="estado" name="estado" maxlength="2" required>
        </div>

        <!-- Script para endereço usando API ViaCEP -->
        <script>
            // URL da API de CEP (ViaCEP)
            const CEP_API_URL = 'https://viacep.com.br/ws/';
        
            // --- FUNÇÃO PARA CONSULTAR O CEP E PREENCHER OS CAMPOS ---
            function consultarCep(cep) {
                // Limpa e normaliza o CEP, removendo o hífen se existir
                const cepLimpo = cep.replace(/\D/g, ''); 
                
                // Referências aos campos do seu HTML
                const bairroInput = document.getElementById('bairro');
                const cidadeInput = document.getElementById('cidade');
                // Usamos 'estado' como ID para o campo de UF/Estado
                const ufInput = document.getElementById('estado'); 
        
                // 1. Validação
                if (cepLimpo.length !== 8) {
                    // Se o CEP não tiver 8 dígitos, não faz a consulta e limpa os campos
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';
                    return;
                }
        
                // 2. Limpa campos e indica que está buscando
                bairroInput.value = 'Buscando...';
                cidadeInput.value = 'Buscando...';
                ufInput.value = 'Buscando...';
                
                // 3. Consulta a API
                fetch(`${CEP_API_URL}${cepLimpo}/json/`)
                    .then(response => response.json())
                    .then(dados => {
                        
                        // 4. Se houver erro ou o CEP não for encontrado
                        if (dados.erro) {
                            alert('CEP não encontrado!');
                            bairroInput.value = '';
                            cidadeInput.value = '';
                            ufInput.value = '';
                            return;
                        }
        
                        // 5. Preenche os campos diretamente
                        // O Logradouro (Rua) é ignorado, mas o usuário pode vê-lo na resposta de depuração se quiser.
                        bairroInput.value = dados.bairro || '';
                        cidadeInput.value = dados.localidade || ''; // 'localidade' é a cidade no ViaCEP
                        ufInput.value = dados.uf || ''; 
        
                    })
                    .catch(error => {
                        console.error('Erro na consulta de CEP:', error);
                        alert('Erro ao consultar o CEP. Tente novamente.');
                        
                        // Limpa campos em caso de erro de conexão
                        bairroInput.value = '';
                        cidadeInput.value = '';
                        ufInput.value = '';
                    });
            }
        
        
            // --- Inicialização e Event Listeners ---
            
            // NOVO Evento: Consultar CEP ao sair do campo (evento 'blur')
            // É necessário que você tenha um campo com id="cep" no seu HTML
            document.getElementById('cep').addEventListener('blur', function() {
                consultarCep(this.value);
            });
        
            // Opcional: Para executar a busca ao pressionar Enter no campo CEP
            document.getElementById('cep').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    consultarCep(this.value);
                }
            });
        </script>

        <!-- campo de opção para gênero do aluno -->
        <label for  = "genero">Gênero:</label>
        <select id = "genero" name= "genero" required>
            <option value = "">               Selecione           </option>
            <option value = "Masculino">         Masculino              </option>
            <option value = "Feminino">          Feminino               </option>
        </select>

        <!-- campo de opção para etnia do aluno -->
        <label for  = "etnia">Identificação Étnico-Racial:</label>

        <select id  = "etnia" name = "etnia" required>
            <option value = "">               Selecione           </option>
            <option value = "Branca">         Branca              </option>
            <option value = "Preta">          Preta               </option>
            <option value = "Parda">          Parda               </option>
            <option value = "Indígena">       Indígena            </option>
            <option value = "Amarela">        Amarela             </option>
            <option value = "Naoidentificar"> Não me indentificar </option>
        </select>

        <!-- campo de opção para notificações ao aluno -->
        <label for  = "notificacoes">Deseja receber notificações por e-mail</label>
        <input type = "checkbox" name="notificacoes" id="notificacoes"><br>
          
        <button type = "submit">Cadastrar</button>
    </form>

    
</body>

</html>