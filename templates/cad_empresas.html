<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- !!! CORRIGIDO: O CSS deve estar no <head> !!! -->
    <link rel="stylesheet" href="../static/css/style.css">
    <title>Cadastro de Empresas</title>
</head>

<body>
    <header>
        <nav>
            <button class="menu-btn">☰</button>

            <ul class="menu">
                <li><a href="/"> Início </a></li>
                <li><a href="/sobre"> Sobre </a></li>
                <li><a href="/blog"> Blog </a></li>
                <li><a href="/perfil"> Perfil </a></li>
                <li><a href="/cadastrar"> Cadastros </a></li>
                <li><a href="/divulgacao_escolas"> Escolas </a></li>
            </ul>
        </nav>
    </header>
    <!-- !!! CORRIGIDO: 'action' removido. O form enviará para a própria URL. !!! -->
    <form method="POST">

        <h1>CADASTRO DE EMPRESAS</h1>

        <!-- Corrigido: 'name', 'id' e 'for' atualizados para "nome" -->
        <label for="nome">Nome da Empresa:</label>
        <input type="text" name="nome" id="nome" required>

        <!-- Corrigido: 'id' e 'for' adicionados -->
        <label for="nome_fantasia">Nome fantasia:</label>
        <input type="text" name="nome_fantasia" id="nome_fantasia">

        <!-- Corrigido: 'name', 'id' e 'for' atualizados para "cnpj" (minúsculo) -->
        <label for="cnpj">CNPJ:</label>
        <input type="text" name="cnpj" id="cnpj" required>

        <!-- Corrigido: 'name', 'id' e 'for' atualizados para "email" (minúsculo) -->
        <label for="email">Email:</label>
        <input type="email" name="email" id="email" required>
        
        <!-- Corrigido: 'name', 'id' e 'for' atualizados para "area_atuacao" -->
        <label for="area_atuacao">Área de atuação:</label>
        <input type="text" id="area_atuacao" name="area_atuacao" required>

        <!-- Endereço  -->
        <div>
            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" placeholder="Ex: 01001000" maxlength="9" required>
        </div>
        
        <div>
            <label for="rua">Rua:</label>
            <input type="text" id="rua" name="rua" required readonly>
        </div>
            
        <div>
            <label for="numero">Número:</label>
            <input type="text" id="numero" name="numero" required>
        </div>
            
        <div>
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" required readonly>
        </div>
            
        <div>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" required readonly>
        </div>
            
        <div>
            <label for="estado">Estado (UF):</label>
            <input type="text" id="estado" name="estado" maxlength="2" required readonly>
        </div>

        <!-- Script de endereço  -->
        <script>
            // URL da API de CEP (ViaCEP)
            const CEP_API_URL = 'https://viacep.com.br/ws/';
        
            // --- FUNÇÃO PARA CONSULTAR O CEP E PREENCHER OS CAMPOS ---
            function consultarCep(cep) {
                // Limpa e normaliza o CEP
                const cepLimpo = cep.replace(/\D/g, ''); 
                
                // 1. Referências aos campos do seu HTML
                const logradouroInput = document.getElementById('rua');
                const numeroInput = document.getElementById('numero');
                const bairroInput = document.getElementById('bairro');
                const cidadeInput = document.getElementById('cidade');
                const ufInput = document.getElementById('estado'); 
        
                // 2. Validação básica e limpeza
                if (cepLimpo.length !== 8) {
                    logradouroInput.value = '';
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';
                    return;
                }
        
                // 3. Limpa campos e indica que está buscando
                logradouroInput.value = 'Buscando...';
                bairroInput.value = 'Buscando...';
                cidadeInput.value = 'Buscando...';
                ufInput.value = 'Buscando...';
                numeroInput.value = ''; // Limpa o número da casa anterior
                
                // 4. Consulta a API
                fetch(`${CEP_API_URL}${cepLimpo}/json/`)
                    .then(response => response.json())
                    .then(dados => {
                        
                        if (dados.erro) {
                            alert('CEP não encontrado!');
                            logradouroInput.value = '';
                            bairroInput.value = '';
                            cidadeInput.value = '';
                            ufInput.value = '';
                            return;
                        }
        
                        // 5. Preenche os campos
                        logradouroInput.value = dados.logradouro || ''; // logradouro (Rua)
                        bairroInput.value = dados.bairro || '';
                        cidadeInput.value = dados.localidade || ''; 
                        ufInput.value = dados.uf || ''; 
                        
                        // 6. Move o foco para o campo de número da casa
                        numeroInput.focus();
        
                    })
                    .catch(error => {
                        console.error('Erro na consulta de CEP:', error);
                        alert('Erro ao consultar o CEP. Tente novamente.');
                        
                        // Limpa campos em caso de erro
                        logradouroInput.value = '';
                        bairroInput.value = '';
                        cidadeInput.value = '';
                        ufInput.value = '';
                    });
            }
        
        
            // --- Inicialização e Event Listeners ---
            
            // Evento: Consultar CEP ao sair do campo (evento 'blur')
            document.getElementById('cep').addEventListener('blur', function() {
                consultarCep(this.value);
            });
        
            // Opcional: Para executar a busca ao pressionar Enter no campo CEP
            document.getElementById('cep').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    consultarCep(this.value);
                }
            });
        </script>

        <label for="telefone">Telefone:</label>
        <input type="text" id="telefone" name="telefone" required>
        
        <button type="submit">Cadastrar</button>
    </form>

</body>

</html>