<!DOCTYPE html>
<html lang = "pt-br">

<head>
    <meta charset = "UTF-8">
    <meta name    = "viewport"   content = "width=device-width, initial-scale=1.0">
    <link rel     = "stylesheet" href    = "../static/css/style.css">
    <title>Cadastro de Escolas</title>
</head>

<body>
    <header>
        <nav>
            <button class="menu-btn">‚ò∞</button>

            <ul class="menu">
                <li><a href="/"> In√≠cio </a></li>
                <li><a href="/sobre"> Sobre </a></li>
                <li><a href="/blog"> Blog </a></li>
                <li><a href="/login"> Login </a></li>
                <li><a href="/divulgacao_escolas"> Escolas </a></li>
                <li><a href="/vagas"> Vagas </a></li>
                <li><a href="/cursos"> Cursos </a></li>
                <li><a href="/mapa"> Mapa</a></li>
                <li><a href="/chat"> Chat </a></li>
            </ul>

            <!-- üß© BLOCO DE INFORMA√á√ÉO DO USU√ÅRIO LOGADO -->
            {% if session.usuario %}
            <div class="usuario-logado">
                <span>üë§ {{ session.usuario["nome"] }}</span>
                <a href="/logout" class="btn-logout">Sair</a>
            </div>
            {% endif %}
        </nav>
    </header>
    
    <h1>Cadastro de Escolas</h1>
    <form action="http://127.0.0.1:5000/cadastrar_escola" method="POST" class="cadform">
        
        <!-- campo para nome da escola -->
        <label for  = "Nome_da_instituicao">Nome da instituicao:</label>
        <input type = "text" id="Nome_da_instituicao" name="Nome_da_instituicao" required>

        <!-- campo para tipo da escola -->
        <label for  = "Tipo_de_instituicao">Tipo de instituicao:</label>
        <select type= "text"  id="Tipo_de_instituicao" name="Tipo_de_instituicao" required>
            <option value = "">Selecione</option>
            <option value = "Escola particular"> Escola particular </option>
            <option value = "Escola p√∫blica">    Escola p√∫blica    </option>
            <option value = "Escola t√©cnica">    Escola t√©cnica    </option>
        </select>

        <!-- campo para INEP da escola -->
        <label for  = "INEP"> INEP: </label>
        <input type = "text" id="INEP" name="INEP" required>

        <!-- campo para CNPJ da escola -->
        <label for  = "CNPJ"> CNPJ: </label>
        <input type = "text" id="CNPJ" name="CNPJ" required>

        <!-- campo para telefone da escola -->
        <label for  = "Telefone"> Telefone (+55): </label>
        <input type = "tel" name="Telefone" id="Telefone" required>

        <!-- campo para e-mail da escola -->
        <label for  = "Email"> Email: </label>
        <input type = "email" name="Email" id="Email" required>

        <!-- Endere√ßo  -->
        <div>
            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" placeholder="Ex: 01001000" maxlength="9" required>
        </div>
        
        <div>
            <label for="rua">Rua:</label>
            <input type="text" id="rua" name="rua" required readonly>
        </div>
            
        <div>
            <label for="numero">N√∫mero:</label>
            <input type="text" id="numero" name="numero" required>
        </div>
            
        <div>
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" required readonly>
        </div>
            
        <div>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" required readonly>
        </div>
            
        <div>
            <label for="estado">Estado (UF):</label>
            <input type="text" id="estado" name="estado" maxlength="2" required readonly>
        </div>

        <!-- Script de endere√ßo  -->
        <script>
            // URL da API de CEP (ViaCEP)
            const CEP_API_URL = 'https://viacep.com.br/ws/';
        
            // --- FUN√á√ÉO PARA CONSULTAR O CEP E PREENCHER OS CAMPOS ---
            function consultarCep(cep) {
                // Limpa e normaliza o CEP
                const cepLimpo = cep.replace(/\D/g, ''); 
                
                // 1. Refer√™ncias aos campos do seu HTML
                const logradouroInput = document.getElementById('rua');
                const numeroInput = document.getElementById('numero');
                const bairroInput = document.getElementById('bairro');
                const cidadeInput = document.getElementById('cidade');
                const ufInput     = document.getElementById('estado'); 
        
                // 2. Valida√ß√£o b√°sica e limpeza
                if (cepLimpo.length !== 8) {
                    logradouroInput.value = '';
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';
                    return;
                }
        
                // 3. Limpa campos e indica que est√° buscando
                logradouroInput.value = 'Buscando...';
                bairroInput.value = 'Buscando...';
                cidadeInput.value = 'Buscando...';
                ufInput.value = 'Buscando...';
                numeroInput.value = ''; // Limpa o n√∫mero da casa anterior
                
                // 4. Consulta a API
                fetch(`${CEP_API_URL}${cepLimpo}/json/`)
                    .then(response => response.json())
                    .then(dados => {
                        
                        if (dados.erro) {
                            alert('CEP n√£o encontrado!');
                            logradouroInput.value = '';
                            bairroInput.value = '';
                            cidadeInput.value = '';
                            ufInput.value = '';
                            return;
                        }
        
                        // 5. Preenche os campos
                        logradouroInput.value = dados.logradouro || ''; // logradouro (Rua)
                        bairroInput.value = dados.bairro || '';
                        cidadeInput.value = dados.localidade || ''; 
                        ufInput.value = dados.uf || ''; 
                        
                        // 6. Move o foco para o campo de n√∫mero da casa
                        numeroInput.focus();
        
                    })
                    .catch(error => {
                        console.error('Erro na consulta de CEP:', error);
                        alert('Erro ao consultar o CEP. Tente novamente.');
                        
                        // Limpa campos em caso de erro
                        logradouroInput.value = '';
                        bairroInput.value = '';
                        cidadeInput.value = '';
                        ufInput.value = '';
                    });
            }
        
        
            // --- Inicializa√ß√£o e Event Listeners ---
            
            // Evento: Consultar CEP ao sair do campo (evento 'blur')
            document.getElementById('cep').addEventListener('blur', function() {
                consultarCep(this.value);
            });
        
            // Opcional: Para executar a busca ao pressionar Enter no campo CEP
            document.getElementById('cep').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    consultarCep(this.value);
                }
            });
        </script>
            
        <!-- campo de op√ß√£o para tunro de funcionamento da escola -->
        <label for   = "Turno_de_funcionamento">Turno de funcionamento:</label>
        <select type = "text" id="Turno_de_funcionamento" name="Turno_de_funcionamento" required> 
            <option value = "">           Selecione  </option>
            <Option value = "Matutino">   Matutino   </Option>
            <Option value = "Vespertino"> Vespertino </Option>
            <Option value = "Noturno">    Noturno    </Option>
            <option value = "Integral">   Integral   </option>
        </select>

        <!-- campo de op√ß√£o para n√≠vel de escolaridade da escola -->
        <label for   = "Nivel_de_escolaridade">N√≠vel de escolaridade:</label>

        <select type = "text"id="Nivel_de_escolaridade" name="Nivel_de_escolaridade"  required>
            <option value = "">Selecione</option>
            <option value = "Ens. Fundamental II">              Ens. Fundamental II              </option>
            <option value = "Ens. Medio">                       Ens. Medio                       </option>
            <option value = "Ens. Fundamental II e Ens. Medio"> Ens. Fundamental II e Ens. Medio </option>
        </select>

        <button type = "submit">Cadastrar</button>
        
    </form>
</body>
</html>