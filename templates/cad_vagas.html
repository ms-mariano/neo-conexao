<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/style.css">
    <title>Cadastro de Vagas</title>
</head>

<body>
    <header>
        <nav>
            <button class="menu-btn">‚ò∞</button>

            <ul class="menu">
                <li><a href="/"> In√≠cio </a></li>
                <li><a href="/sobre"> Sobre </a></li>
                <li><a href="/blog"> Blog </a></li>
                <li><a href="/login"> Login </a></li>
                <li><a href="/divulgacao_escolas"> Escolas </a></li>
                <li><a href="/vagas"> Vagas </a></li>
                <li><a href="/cursos"> Cursos </a></li>
                <li><a href="/mapa"> Mapa</a></li>
                <li><a href="/chat"> Chat </a></li>
            </ul>

            <!-- üß© BLOCO DE INFORMA√á√ÉO DO USU√ÅRIO LOGADO -->
            {% if session.usuario %}
            <div class="usuario-logado">
                <span>üë§ {{ session.usuario["nome"] }}</span>
                <a href="/logout" class="btn-logout">Sair</a>
            </div>
            {% endif %}
        </nav>
    </header>

    <h1>Cadastro de Vagas</h1>

    <form method="POST" class="cadform">

        <label for="titulo">T√≠tulo:</label>
        <input type="text" id="titulo" name="titulo" required>

        <label for="descricao">Descri√ß√£o:</label>
        <input type="text" id="descricao" name="descricao" required>

        <label for="nome_empresa">Nome da Empresa:</label>
        <select name="nome_empresa" id="nome_empresa" required>
            <option value="" disabled selected>Selecione a Empresa</option>
            {% for i in empresas %}
            <option 
                value="{{ i.nome_empresa }}" 
                data-telefone="{{ i.telefone }}">
                {{ i.nome_fantasia }} ({{ i.area_atuacao }})
            </option>
            {% endfor %}
        </select>

        <!-- Campo oculto que receber√° o telefone -->
        <input type="hidden" id="telefone_empresa" name="telefone_empresa">

        <label for="remuneracao">Remunera√ß√£o:</label>
        <input type="text" id="remuneracao" name="remuneracao" required>

        <label for="carga_horaria">Carga Hor√°ria:</label>
        <input type="text" id="carga_horaria" name="carga_horaria" required>

        <label for="requisitos">Requisitos:</label>
        <input type="text" id="requisitos" name="requisitos" required>

        <label for="tipo">Tipo de vagas:</label>
        <select id="tipo" name="tipo" required>
            <option value="" disabled selected>Selecione</option>
            <option value="Jovem aprendiz"> Jovem aprendiz </option>
            <option value="Estagio"> Est√°gio </option>
            <option value="Treinee"> Treinee </option>
            <option value="Emprego"> Emprego </option>
        </select>

        <label for="cep_vaga">CEP da vaga:</label>
        <input type="text" id="cep_vaga" name="cep_vaga" required>

        <label for="rua">Rua:</label>
        <input type="text" id="rua" name="rua">

        <label for="numero">N√∫mero:</label>
        <input type="text" id="numero" name="numero">

        <label for="bairro">Bairro:</label>
        <input type="text" id="bairro" name="bairro" required>

        <label for="cidade">Cidade:</label>
        <input type="text" id="cidade" name="cidade" required>

        <label for="estado">Estado:</label>
        <select name="estado" id="estado" required>
            <option value="" disabled selected>Selecione</option>
            <option value="AC"> AC </option>
            <option value="AL"> AL </option>
            <option value="AM"> AM </option>
            <option value="AP"> AP </option>
            <option value="BA"> BA </option>
            <option value="CE"> CE </option>
            <option value="DF"> DF </option>
            <option value="ES"> ES </option>
            <option value="GO"> GO </option>
            <option value="MA"> MA </option>
            <option value="MG"> MG </option>
            <option value="MS"> MS </option>
            <option value="MT"> MT </option>
            <option value="PA"> PA </option>
            <option value="PB"> PB </option>
            <option value="PE"> PE </option>
            <option value="PI"> PI </option>
            <option value="PR"> PR </option>
            <option value="RJ"> RJ </option>
            <option value="RN"> RN </option>
            <option value="RO"> RO </option>
            <option value="RR"> RR </option>
            <option value="RS"> RS </option>
            <option value="SC"> SC </option>
            <option value="SE"> SE </option>
            <option value="SP"> SP </option>
            <option value="TO"> TO </option>
        </select>

        <button type="submit">Cadastrar</button>

    </form>

    <script>
        // --- Auto preencher telefone da empresa ---
        document.getElementById("nome_empresa").addEventListener("change", function() {
            const telefone = this.options[this.selectedIndex].getAttribute("data-telefone");
            document.getElementById("telefone_empresa").value = telefone || "";
        });

        // --- Integra√ß√£o com a API ViaCEP ---
        const CEP_API_URL = 'https://viacep.com.br/ws/';

        function consultarCep(cep) {
            const cepLimpo = cep.replace(/\D/g, '');
            const ruaInput = document.getElementById('rua');
            const numeroInput = document.getElementById('numero');
            const bairroInput = document.getElementById('bairro');
            const cidadeInput = document.getElementById('cidade');
            const ufInput = document.getElementById('estado');

            if (cepLimpo.length !== 8) {
                ruaInput.value = '';
                bairroInput.value = '';
                cidadeInput.value = '';
                ufInput.value = '';
                return;
            }

            ruaInput.value = 'Buscando...';
            bairroInput.value = 'Buscando...';
            cidadeInput.value = 'Buscando...';
            ufInput.value = 'Buscando...';
            numeroInput.value = '';

            fetch(`${CEP_API_URL}${cepLimpo}/json/`)
                .then(response => response.json())
                .then(dados => {
                    if (dados.erro) {
                        alert('CEP n√£o encontrado!');
                        ruaInput.value = '';
                        bairroInput.value = '';
                        cidadeInput.value = '';
                        ufInput.value = '';
                        return;
                    }

                    ruaInput.value = dados.logradouro || '';
                    bairroInput.value = dados.bairro || '';
                    cidadeInput.value = dados.localidade || '';
                    ufInput.value = dados.uf || '';
                    numeroInput.focus();
                })
                .catch(error => {
                    console.error('Erro ao buscar CEP:', error);
                    alert('Erro ao consultar o CEP. Tente novamente.');
                    ruaInput.value = '';
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';
                });
        }

        // Chamar a busca ao sair do campo de CEP
        document.getElementById('cep_vaga').addEventListener('blur', function() {
            consultarCep(this.value);
        });

        // Buscar ao apertar Enter no campo CEP
        document.getElementById('cep_vaga').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                consultarCep(this.value);
            }
        });
    </script>

</body>

</html>